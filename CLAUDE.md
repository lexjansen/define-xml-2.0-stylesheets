# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

XSLT stylesheets for rendering CDISC Define-XML 2.0 documents as interactive HTML. Originally developed in the PhUSE Define-XML 2.0 Stylesheet Recommendations project (archived in `phuse-2018/`), with the active version in `localization/` adding multi-language support (English, Japanese, Chinese).

## Key Commands

### Run full test suite (from `test/` directory)

```powershell
cd test
pwsh ./transform_definexml.ps1
```

Requires Java 8+ in PATH. Uses Saxon HE 12.9 (`lib/SaxonHE12-9J/saxon-he-12.9.jar`). Generates ~38 HTML files in `test/html/` across 4 XML inputs, 3 languages, and 2 parameter configurations. Output is logged to `test/transform_definexml.log`.

### Transform a single file

```powershell
# Using .NET XslCompiledTransform (no Java required):
pwsh scripts/xml2html.ps1 localization/define2-0.xsl test/xml/define.cdisc.adam.xml output.html en

# Using Saxon directly:
java net.sf.saxon.Transform -s:test/xml/define.cdisc.adam.xml -xsl:localization/define2-0.xsl -o:output.html interfaceLang=en
```

## Architecture

### Transformation Pipeline

Define-XML (input XML) → Saxon HE 12.9 or .NET XSLT → `localization/define2-0.xsl` (loads `dictionary.xml`) → HTML 4.01 Strict output

### Core Files

- **`localization/define2-0.xsl`** (~4,800 lines): The main XSLT 1.0 stylesheet. Handles CDISC ODM 1.3, Define-XML 2.0, ARM 1.0, and xlink namespaces. Uses `document()` function to load the external dictionary.
- **`localization/dictionary.xml`**: Translation lookup file with terms in English, Japanese (`ja`), and Chinese (`zh`).
- **`test/transform_definexml.ps1`**: Full test suite. Two transform functions: `Invoke-Transform` (default params) and `Invoke-TransformWithParams` (all display options enabled). Includes issue-specific regression tests.
- **`scripts/xml2html.ps1`**: Single-file converter using .NET `XslCompiledTransform` (alternative to Saxon, no Java needed).

### Stylesheet Parameters

The stylesheet accepts these parameters (set via Saxon command line or XSLT argument list):

| Parameter | Default | Description |
| ----------- | --------- | ------------- |
| `interfaceLang` | `en` | UI language (`en`, `ja`, `zh`) |
| `nCodeListItemDisplay` | `5` | Max codelist items to display inline |
| `nCheckValueDisplay` | `5` | Max WhereClause decode values to display |
| `displayMethodsTable` | `1` | Show methods table (0/1) |
| `displayCommentsTable` | `1` | Show comments table (0/1) |
| `displayPrefix` | `1` | Show dataset/variable prefixes (0/1) |
| `displayLengthDFormatSD` | `1` | Show length/format/significant digits (0/1) |

### Directory Layout

- `localization/` — Active stylesheet and dictionary (this is the code you edit)
- `phuse-2018/` — Original PhUSE 2018 deliverable (archived, do not modify)
- `test/xml/` — Test Define-XML input files (ADaM, ARM, SDTM, PhUSE test, issue-specific)
- `test/html/` — Generated HTML output (not source-controlled content, regenerated by test script)
- `lib/SaxonHE12-9J/` — Saxon HE 12.9 XSLT processor (Java JAR)
- `schema/` — CDISC XML Schema definitions (ODM 1.3.2, Define-XML 2.0, ARM 1.0)
- `scripts/` — Utility scripts for single-file conversion

### XML Namespaces Used in Stylesheet

- `xmlns:odm` — CDISC ODM 1.3.2
- `xmlns:def` — Define-XML 2.0 extension
- `xmlns:arm` — Analysis Results Metadata 1.0
- `xmlns:xlink` — XLink for external references
